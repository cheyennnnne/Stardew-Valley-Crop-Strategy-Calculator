<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿéœ²è°·ä½œç‰©åˆ©æ¶¦è®¡ç®—å™¨ (Pro Maxç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('https://stardewvalleywiki.com/mediawiki/extensions/StardewValley/images/stardewbackground.png') repeat fixed;
            background-color: #f0f4c3;
            color: #4e342e;
        }

        .wood-panel {
            background-color: rgba(215, 204, 200, 0.96);
            border: 4px solid #8d6e63;
            border-radius: 8px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
            backdrop-filter: blur(4px);
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 4px;
            color: #5d4037;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #8d6e63;
            border-radius: 4px;
            background-color: rgba(255, 248, 225, 0.9);
            color: #3e2723;
        }

        .btn-primary {
            background-color: #66bb6a;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            border: 2px solid #388e3c;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 2px 2px 0px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn-primary:active {
            transform: translate(1px, 1px);
        }

        .crop-card {
            background-color: rgba(255, 243, 224, 0.95);
            border: 2px solid #bcaaa4;
            transition: all 0.2s;
            position: relative;
        }
        .crop-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .strategy-card {
            background-color: rgba(243, 229, 245, 0.95);
            border: 2px solid #9c27b0;
            border-radius: 8px;
            margin-bottom: 0;
            overflow: hidden;
            transition: all 0.2s;
            position: relative;
        }
        .strategy-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(156, 39, 176, 0.2);
            z-index: 10;
        }

        .strategy-summary {
            cursor: pointer;
            background-color: rgba(225, 190, 231, 0.95);
            transition: background-color 0.2s;
            outline: none;
        }
        .strategy-summary:hover {
            background-color: rgba(206, 147, 216, 0.95);
        }
        .strategy-details {
            padding: 16px;
            background-color: rgba(243, 229, 245, 0.95);
            border-top: 1px solid #ba68c8;
        }

        .rank-badge {
            font-size: 0.8rem;
            min-width: 24px;
            height: 24px;
            padding: 0 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: bold;
            margin-right: 12px;
            flex-shrink: 0;
            z-index: 20;
        }
        .rank-1 { background-color: #ffd700; color: #5d4037; border: 2px solid #ffb300; }
        .rank-2 { background-color: #e0e0e0; color: #424242; border: 2px solid #bdbdbd; }
        .rank-3 { background-color: #ffcc80; color: #5d4037; border: 2px solid #ff9800; }
        .rank-other { background-color: #f5f5f5; color: #9e9e9e; border: 2px solid #e0e0e0; font-size: 0.75rem; }

        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }

        .crop-icon-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .crop-icon-img {
            width: 80%;
            height: 80%;
            object-fit: contain;
            filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.1));
            transition: transform 0.2s;
        }
        .crop-icon-img:hover {
            transform: scale(1.1);
        }

        /* Custom Scrollbar for Filters */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.05);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #bcaaa4;
            border-radius: 3px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #8d6e63;
        }

        /* Table Styles */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        .data-table th {
            background-color: rgba(141, 110, 99, 0.2);
            color: #5d4037;
            font-weight: bold;
            padding: 6px;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(2px);
        }
        .data-table td {
            padding: 4px 6px;
            border-bottom: 1px solid rgba(141, 110, 99, 0.1);
        }
        .data-table tr:nth-child(even) {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .data-table tr:hover {
            background-color: rgba(255, 255, 255, 0.6);
        }
        .table-input {
            width: 100%;
            padding: 1px 4px;
            border: 1px solid #bcaaa4;
            border-radius: 3px;
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-6xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2 drop-shadow-md" style="text-shadow: 2px 2px 0 #5d4037;">ğŸŒ± æ˜Ÿéœ²è°·ä½œç‰©è®¡ç®—å™¨</h1>
        <p class="text-white font-bold drop-shadow-md" style="text-shadow: 1px 1px 0 #5d4037;">è®¡ç®—æœ€ä½³ç§æ¤æ–¹æ¡ˆ</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- Sidebar: Inputs -->
        <div class="lg:col-span-4 space-y-6">
            <!-- Farm Status -->
            <div class="wood-panel p-6">
                <h2 class="text-xl font-bold mb-4 border-b-2 border-brown-400 pb-2">ğŸ“Š å†œåœºçŠ¶å†µ</h2>

                <div class="space-y-4">
                    <div class="input-group">
                        <label>å½“å‰å­£èŠ‚</label>
                        <select id="seasonSelect" onchange="updateUI();">
                            <option value="spring">ğŸŒ¸ æ˜¥å­£ (Spring)</option>
                            <option value="summer">â˜€ï¸ å¤å­£ (Summer)</option>
                            <option value="fall">ğŸ‚ ç§‹å­£ (Fall)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>å½“å‰æ—¥æœŸ (1-28)</label>
                        <input type="number" id="currentDay" min="1" max="28" value="1" onchange="calculate()">
                        <p class="text-xs text-gray-700 font-bold mt-1">å‰©ä½™å¤©æ•°: <span id="daysRemainingDisplay">27</span> å¤©</p>
                    </div>

                    <div class="input-group">
                        <label>ç°æœ‰èµ„é‡‘ (G)</label>
                        <input type="number" id="budget" min="0" value="500" step="10" onchange="calculate()">
                    </div>

                    <div class="input-group">
                        <label>å¯ç”¨è€•åœ° (æ ¼)</label>
                        <input type="number" id="tiles" min="1" value="100" onchange="calculate()">
                    </div>
                </div>
            </div>

            <!-- Strategy -->
            <div class="wood-panel p-6">
                <h2 class="text-xl font-bold mb-4 border-b-2 border-brown-400 pb-2">ğŸ¯ ç§æ¤ç­–ç•¥</h2>
                <div class="space-y-3">
                    <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-white hover:bg-opacity-30 transition">
                        <input type="radio" name="strategy" value="seasonal" checked onchange="calculate()" class="w-5 h-5 text-green-600">
                        <div>
                            <span class="font-bold">ğŸŒ± è¿ç»­ç§æ¤ç­–ç•¥ (é»˜è®¤)</span>
                            <span class="text-xs block text-gray-700">åˆ©æ¶¦å†æŠ•èµ„ï¼ŒæŒç»­è¡¥ç§ã€‚</span>
                        </div>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-white hover:bg-opacity-30 transition">
                        <input type="radio" name="strategy" value="single" onchange="calculate()" class="w-5 h-5 text-blue-600">
                        <div>
                            <span class="font-bold">ğŸ›’ å•æ¬¡ç§æ¤ç­–ç•¥</span>
                            <span class="text-xs block text-gray-700">ä»…ä¹°ä¸€è½®ç§å­ã€‚</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Crop Constraints (Modified Table Style) -->
            <div class="wood-panel p-6">
                <details>
                    <summary class="font-bold text-brown-800 cursor-pointer flex justify-between items-center">
                        <span>âš™ï¸ é™åˆ¶å•æ¬¡/è¿ç§è½®æ•°</span>
                        <span class="text-xs text-gray-600">â–¼</span>
                    </summary>
                    <div class="mt-4 max-h-60 overflow-y-auto custom-scroll border border-gray-300 rounded bg-white bg-opacity-50" id="constraintsContainer">
                        <!-- Table Content -->
                    </div>
                    <p class="text-xs text-gray-500 mt-2">* ç©ºç™½è¡¨ç¤ºæ— é™åˆ¶ï¼Œ0 è¡¨ç¤ºä¸ç§æ¤</p>
                </details>
            </div>

            <!-- Filter & Sort (Modified Table Style) -->
            <div class="wood-panel p-6">
                <h2 class="text-xl font-bold mb-4 border-b-2 border-brown-400 pb-2">ğŸ” ç­›é€‰ä¸æ’åº</h2>

                <!-- Crop Filter Table (Merged Include/Exclude) -->
                <div class="mb-4">
                    <label class="text-sm font-bold text-brown-800 mb-1 block">ä½œç‰©ç­›é€‰ (åŒ…å«/æ’é™¤)</label>
                    <div id="cropFilterTableContainer" class="h-48 overflow-y-auto bg-white bg-opacity-60 border border-gray-300 rounded p-0 text-xs custom-scroll">
                        <!-- Table injected via JS -->
                    </div>
                </div>

                <!-- Numeric Filters Table (New) -->
                <div class="mb-4">
                    <label class="text-sm font-bold text-brown-800 mb-1 block">æ•°å€¼ç­›é€‰</label>
                    <table class="data-table">
                        <thead>
                        <tr >
                            <th>æŒ‡æ ‡</th>
                            <th class="text-center w-20"> æœ€å°‘ </th>
                            <th class="text-center w-20"> æœ€å¤š </th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td class="text-gray-700">åˆ©æ¶¦ (G)</td>
                            <td><input type="number" id="filterProfitMin" class="table-input" placeholder="ä¸é™" onchange="calculate()"></td>
                            <td><input type="number" id="filterProfitMax" class="table-input" placeholder="ä¸é™" onchange="calculate()"></td>
                        </tr>
                        <tr>
                            <td class="text-gray-700">æ’­ç§ (æ¬¡)</td>
                            <td><input type="number" id="filterPlantingMin" class="table-input" placeholder="ä¸é™" onchange="calculate()"></td>
                            <td><input type="number" id="filterPlantingMax" class="table-input" placeholder="ä¸é™" onchange="calculate()"></td>
                        </tr>
                        <tr>
                            <td class="text-gray-700">ç”Ÿé•¿ (å¤©)</td>
                            <td><input type="number" id="filterDaysMin" class="table-input" placeholder="> å¤©" onchange="calculate()"></td>
                            <td><input type="number" id="filterDaysMax" class="table-input" placeholder="< å¤©" onchange="calculate()"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Sorting Table (New) -->
                <div>
                    <label class="text-sm font-bold text-brown-800 mb-1 block">æ’åºè®¾ç½®</label>
                    <table class="data-table">
                        <tbody>
                        <tr>
                            <td class="text-gray-700 w-1/3">æ’åºä¾æ®</td>
                            <td>
                                <select id="sortType" class="table-input text-left" onchange="calculate()">
                                    <option value="profit">æ€»åˆ©æ¶¦</option>
                                    <option value="planting">æ’­ç§æ¬¡æ•°</option>
                                    <option value="days">æ”¶è·å‘¨æœŸ</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td class="text-gray-700">æ’åºæ–¹å¼</td>
                            <td>
                                <select id="sortOrder" class="table-input text-left" onchange="calculate()">
                                    <option value="desc">é™åº â¬‡ï¸</option>
                                    <option value="asc">å‡åº â¬†ï¸</option>
                                </select>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Fertilizer & Skills -->
            <div class="wood-panel p-6">
                <h2 class="text-xl font-bold mb-4 border-b-2 border-brown-400 pb-2">ğŸ§ª è‚¥æ–™ä¸æŠ€èƒ½</h2>

                <div class="input-group mb-4">
                    <label>ä½¿ç”¨è‚¥æ–™</label>
                    <select id="fertilizerSelect" onchange="calculate()">
                        <option value="none">æ— è‚¥æ–™ (0g)</option>
                        <option value="basic">åˆçº§è‚¥æ–™ (100g) - å”®ä»·+10%</option>
                        <option value="quality">é«˜çº§è‚¥æ–™ (150g) - å”®ä»·+20%</option>
                        <option value="speed">ç”Ÿé•¿æ¿€ç´  (100g) - ç”Ÿé•¿-10%</option>
                        <option value="deluxe">é«˜çº§ç”Ÿé•¿æ¿€ç´  (150g) - ç”Ÿé•¿-25%</option>
                    </select>
                </div>

                <div class="space-y-3">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="perkTiller" onchange="calculate()" class="w-5 h-5 text-green-600">
                        <span>è€•ç§äºº<span class="text-xs text-gray-600 block"> (å”®ä»·+10%)</span></span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="perkAgriculturist" onchange="calculate()" class="w-5 h-5 text-green-600">
                        <span>å†œä¸šå­¦å®¶<span class="text-xs text-gray-600 block"> (ç”Ÿé•¿é€Ÿåº¦-10%)</span></span>
                    </label>
                </div>

                <h2 class="text-xl font-bold mt-6 mb-4 border-b-2 border-brown-400 pb-2">ğŸ”“ è§£é”å†…å®¹</h2>
                <div class="space-y-3">
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="unlockYear2" onchange="updateUI();" class="w-5 h-5 text-blue-600">
                        <span>ç¬¬äºŒå¹´/ç‰¹æ®Šä½œç‰© <span class="text-xs text-gray-500 block">(è’œ, çº¢å¶å·å¿ƒèœ, æ´‹è“Ÿ)</span></span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="unlockDesert" onchange="updateUI();" class="w-5 h-5 text-blue-600">
                        <span>æ²™æ¼ ä½œç‰©<span class="text-xs text-gray-600 block">(å¤§é»„, æ¨æ¡ƒ, ç”œèœ)</span></span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="unlockStrawberry" onchange="updateUI();" class="w-5 h-5 text-red-600">
                        <span>å·²æœ‰è‰è“ç§å­<span class="text-xs text-gray-600 block">(é€šå¸¸ä»…å¤æ´»èŠ‚å¯ä¹°)</span></span>
                    </label>
                </div>
            </div>
        </div>

        <!-- Main: Results -->
        <div class="lg:col-span-8">
            <div class="wood-panel p-6 min-h-full flex flex-col">
                <div class="flex justify-between items-center mb-4 border-b-2 border-brown-400 pb-2">
                    <h2 class="text-xl font-bold text-brown-900">ğŸ† æ–¹æ¡ˆç»“æœ</h2>
                    <span class="text-sm text-gray-700 font-bold" id="resultCountBadge">å…± 0 ä¸ªæ–¹æ¡ˆ</span>
                </div>

                <div id="unifiedResultsContainer" class="space-y-4 flex-grow">
                    <!-- All results (Single & Mixed) injected here -->
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-8 text-center text-sm text-white pb-8 drop-shadow-md" style="text-shadow: 1px 1px 2px #5d4037;">
        <p class="font-bold text-lg mb-1">Stardew Valley v1.6.8 Â© ConcernedApe | Website designed by Cheynne</p>
        <p class="text-xs opacity-90 mb-2">æœ¬å·¥å…·ä¸ºéå®˜æ–¹ç²‰ä¸ä½œå“ï¼Œä¸ ConcernedApe æ— å…³ã€‚</p>
        <p class="text-xs opacity-80">æ¸¸æˆç´ æä¸èƒŒæ™¯å›¾ç‰ˆæƒå½’ ConcernedApe æ‰€æœ‰ | æ•°æ®æ¥æºï¼šStardew Valley Wiki</p>
    </footer>
</div>

<script>
    // --- Data Source ---
    const cropData = [
        // Spring
        { id: 'bluejazz', name: 'è“çˆµ (Blue Jazz)', season: 'spring', buy: 30, sell: 50, days: 7, regrow: 0, yield: 1, type: 'flower' },
        { id: 'cauliflower', name: 'èŠ±æ¤°èœ (Cauliflower)', season: 'spring', buy: 80, sell: 175, days: 12, regrow: 0, yield: 1, type: 'veg' },
        { id: 'greenbean', name: 'é’è±† (Green Bean)', season: 'spring', buy: 60, sell: 40, days: 10, regrow: 3, yield: 1, type: 'veg', note: 'æ£šæ¶ä½œç‰©' },
        { id: 'kale', name: 'ç”˜è“èœ (Kale)', season: 'spring', buy: 70, sell: 110, days: 6, regrow: 0, yield: 1, type: 'veg' },
        { id: 'parsnip', name: 'é˜²é£è‰ (Parsnip)', season: 'spring', buy: 20, sell: 35, days: 4, regrow: 0, yield: 1, type: 'veg' },
        { id: 'potato', name: 'åœŸè±† (Potato)', season: 'spring', buy: 50, sell: 80, days: 6, regrow: 0, yield: 1.2, type: 'veg', note: '20%å‡ ç‡åŒå€' },
        { id: 'tulip', name: 'éƒé‡‘é¦™ (Tulip)', season: 'spring', buy: 20, sell: 30, days: 6, regrow: 0, yield: 1, type: 'flower' },
        { id: 'strawberry', name: 'è‰è“ (Strawberry)', season: 'spring', buy: 100, sell: 120, days: 8, regrow: 4, yield: 1, type: 'fruit', special: 'strawberry' },
        { id: 'rhubarb', name: 'å¤§é»„ (Rhubarb)', season: 'spring', buy: 100, sell: 220, days: 13, regrow: 0, yield: 1, type: 'fruit', special: 'desert' },
        { id: 'garlic', name: 'è’œ (Garlic)', season: 'spring', buy: 40, sell: 60, days: 4, regrow: 0, yield: 1, type: 'veg', special: 'year2' },

        // Summer
        { id: 'blueberry', name: 'è“è“ (Blueberry)', season: 'summer', buy: 80, sell: 50, days: 13, regrow: 4, yield: 3, type: 'fruit', note: 'æ¯æ¬¡3ä¸ª' },
        { id: 'corn', name: 'ç‰ç±³ (Corn)', season: 'summer', buy: 150, sell: 50, days: 14, regrow: 4, yield: 1, type: 'veg', note: 'è·¨å­£ä½œç‰©(å¤ç§‹)' },
        { id: 'hops', name: 'å•¤é…’èŠ± (Hops)', season: 'summer', buy: 60, sell: 25, days: 11, regrow: 1, yield: 1, type: 'veg', note: 'æ£šæ¶ä½œç‰©' },
        { id: 'hotpepper', name: 'è¾£æ¤’ (Hot Pepper)', season: 'summer', buy: 40, sell: 40, days: 5, regrow: 3, yield: 1, type: 'fruit' },
        { id: 'melon', name: 'ç”œç“œ (Melon)', season: 'summer', buy: 80, sell: 250, days: 12, regrow: 0, yield: 1, type: 'fruit' },
        { id: 'poppy', name: 'è™ç¾äººèŠ± (Poppy)', season: 'summer', buy: 100, sell: 140, days: 7, regrow: 0, yield: 1, type: 'flower' },
        { id: 'radish', name: 'èåœ (Radish)', season: 'summer', buy: 40, sell: 90, days: 6, regrow: 0, yield: 1, type: 'veg' },
        { id: 'redcabbage', name: 'çº¢å¶å·å¿ƒèœ (Red Cabbage)', season: 'summer', buy: 100, sell: 260, days: 9, regrow: 0, yield: 1, type: 'veg', special: 'year2' },
        { id: 'starfruit', name: 'æ¨æ¡ƒ (Starfruit)', season: 'summer', buy: 400, sell: 750, days: 13, regrow: 0, yield: 1, type: 'fruit', special: 'desert' },
        { id: 'summerspangle', name: 'å¤å­£äº®ç‰‡ (Summer Spangle)', season: 'summer', buy: 50, sell: 90, days: 8, regrow: 0, yield: 1, type: 'flower' },
        { id: 'sunflower', name: 'å‘æ—¥è‘µ (Sunflower)', season: 'summer', buy: 200, sell: 80, days: 8, regrow: 0, yield: 1, type: 'flower', note: 'æ‰è½ç§å­' },
        { id: 'tomato', name: 'è¥¿çº¢æŸ¿ (Tomato)', season: 'summer', buy: 50, sell: 60, days: 11, regrow: 4, yield: 1, type: 'veg' },
        { id: 'wheat', name: 'å°éº¦ (Wheat)', season: 'summer', buy: 10, sell: 25, days: 4, regrow: 0, yield: 1, type: 'grain' },

        // Fall
        { id: 'amaranth', name: 'è‹‹èœ (Amaranth)', season: 'fall', buy: 70, sell: 150, days: 7, regrow: 0, yield: 1, type: 'veg' },
        { id: 'artichoke', name: 'æ´‹è“Ÿ (Artichoke)', season: 'fall', buy: 30, sell: 160, days: 8, regrow: 0, yield: 1, type: 'veg', special: 'year2' },
        { id: 'beet', name: 'ç”œèœ (Beet)', season: 'fall', buy: 20, sell: 100, days: 4, regrow: 0, yield: 1, type: 'veg', special: 'desert' },
        { id: 'bokchoy', name: 'å°ç™½èœ (Bok Choy)', season: 'fall', buy: 50, sell: 80, days: 4, regrow: 0, yield: 1, type: 'veg' },
        { id: 'cranberries', name: 'è”“è¶Šè“ (Cranberries)', season: 'fall', buy: 240, sell: 75, days: 7, regrow: 5, yield: 2, type: 'fruit', note: 'æ¯æ¬¡2ä¸ª' },
        { id: 'eggplant', name: 'èŒ„å­ (Eggplant)', season: 'fall', buy: 20, sell: 60, days: 5, regrow: 5, yield: 1, type: 'veg' },
        { id: 'fairyrose', name: 'ç«ç‘°ä»™å­ (Fairy Rose)', season: 'fall', buy: 200, sell: 290, days: 12, regrow: 0, yield: 1, type: 'flower' },
        { id: 'grape', name: 'è‘¡è„ (Grape)', season: 'fall', buy: 60, sell: 80, days: 10, regrow: 3, yield: 1, type: 'fruit', note: 'æ£šæ¶ä½œç‰©' },
        { id: 'pumpkin', name: 'å—ç“œ (Pumpkin)', season: 'fall', buy: 100, sell: 320, days: 13, regrow: 0, yield: 1, type: 'veg' },
        { id: 'yam', name: 'å±±è¯ (Yam)', season: 'fall', buy: 60, sell: 160, days: 10, regrow: 0, yield: 1, type: 'veg' },
        { id: 'corn_fall', name: 'ç‰ç±³ (Corn)', season: 'fall', buy: 150, sell: 50, days: 14, regrow: 4, yield: 1, type: 'veg', note: 'è·¨å­£ä½œç‰©' }
    ];

    const fertilizers = {
        'none': { cost: 0, growthMod: 1, qualityMod: 1 },
        'basic': { cost: 100, growthMod: 1, qualityMod: 1.1 },
        'quality': { cost: 150, growthMod: 1, qualityMod: 1.2 },
        'speed': { cost: 100, growthMod: 0.9, qualityMod: 1 },
        'deluxe': { cost: 150, growthMod: 0.75, qualityMod: 1 }
    };

    function getCropIconHtml(crop) {
        const match = crop.name.match(/\(([^)]+)\)/);
        let englishName = match ? match[1] : crop.name;
        let filename = englishName.trim().replace(/ /g, '_');
        const imageUrl = `https://zh.stardewvalleywiki.com/Special:FilePath/${filename}.png`;
        const emoji = getEmoji(crop.type);

        return `
            <div class="crop-icon-container">
                <img src="${imageUrl}"
                     alt="${crop.name}"
                     class="crop-icon-img"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
                />
                <span class="crop-emoji" style="display:none;">${emoji}</span>
            </div>
        `;
    }

    function getEmoji(type) {
        switch(type) {
            case 'veg': return 'ğŸ¥¦';
            case 'fruit': return 'ğŸ“';
            case 'flower': return 'ğŸŒ»';
            case 'grain': return 'ğŸŒ¾';
            default: return 'ğŸŒ±';
        }
    }

    // --- Helper for Active Crops ---
    function getValidCrops() {
        const season = document.getElementById('seasonSelect').value;
        const unlockYear2 = document.getElementById('unlockYear2').checked;
        const unlockDesert = document.getElementById('unlockDesert').checked;
        const unlockStrawberry = document.getElementById('unlockStrawberry').checked;
        const currentDay = parseInt(document.getElementById('currentDay').value) || 1;

        let validCrops = cropData.filter(c => c.season === season);
        return validCrops.filter(c => {
            if (!c.special) return true;
            if (c.special === 'year2' && !unlockYear2) return false;
            if (c.special === 'desert' && !unlockDesert) return false;
            if (c.special === 'strawberry' && !unlockStrawberry && currentDay !== 13) return false;
            return true;
        });
    }

    // --- Panel Updates ---
    function updateUI() {
        updateConstraintsPanel();
        updateCropFilterPanel();
        calculate();
    }

    // --- Constraint Table ---
    function updateConstraintsPanel() {
        const container = document.getElementById('constraintsContainer');
        const validCrops = getValidCrops();

        if (validCrops.length === 0) {
            container.innerHTML = '<p class="p-2 text-sm text-gray-500">æ— å¯ç”¨ä½œç‰©</p>';
            return;
        }

        let html = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ä½œç‰©åç§°</th>
                        <th class="text-center w-16">å•æ¬¡é™</th>
                        <th class="text-center w-16">è¿ç§é™</th>
                    </tr>
                </thead>
                <tbody>
        `;

        validCrops.forEach(crop => {
            const name = crop.name.split('(')[0];
            html += `
                <tr>
                    <td class="font-bold text-brown-800">${name}</td>
                    <td><input type="number" min="0" placeholder="-" class="table-input constraint-input" data-id="${crop.id}" data-type="single"></td>
                    <td><input type="number" min="0" placeholder="-" class="table-input constraint-input" data-id="${crop.id}" data-type="continuous"></td>
                </tr>
            `;
        });

        html += `</tbody></table>`;
        container.innerHTML = html;

        document.querySelectorAll('.constraint-input').forEach(input => input.addEventListener('change', calculate));
    }

    // --- Filter Table (Merged Include/Exclude) ---
    function updateCropFilterPanel() {
        const container = document.getElementById('cropFilterTableContainer');
        const validCrops = getValidCrops();

        if (validCrops.length === 0) {
            container.innerHTML = '<p class="p-2 text-sm text-gray-500">æ— å¯ç”¨ä½œç‰©</p>';
            return;
        }

        // Generate Table
        let html = `
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ä½œç‰©åç§°</th>
                        <th class="text-center w-20">âœ…åŒ…å«</th>
                        <th class="text-center w-20">ğŸš«æ’é™¤</th>
                    </tr>
                </thead>
                <tbody>
        `;

        validCrops.forEach(crop => {
            const name = crop.name.split('(')[0];
            html += `
                <tr>
                    <td class="text-gray-700">${name}</td>
                    <td class="text-center">
                        <input type="checkbox" value="${crop.id}" id="inc_${crop.id}" class="crop-filter-checkbox crop-include w-4 h-4 text-green-600 rounded">
                    </td>
                    <td class="text-center">
                        <input type="checkbox" value="${crop.id}" id="exc_${crop.id}" class="crop-filter-checkbox crop-exclude w-4 h-4 text-red-600 rounded">
                    </td>
                </tr>
            `;
        });

        html += `</tbody></table>`;
        container.innerHTML = html;

        // Add Listeners for Mutual Exclusion Logic
        document.querySelectorAll('.crop-include').forEach(cb => {
            cb.addEventListener('change', (e) => {
                if (e.target.checked) {
                    // If checked Include, uncheck Exclude
                    const excludeCb = document.getElementById(`exc_${e.target.value}`);
                    if (excludeCb) excludeCb.checked = false;
                }
                calculate();
            });
        });

        document.querySelectorAll('.crop-exclude').forEach(cb => {
            cb.addEventListener('change', (e) => {
                if (e.target.checked) {
                    // If checked Exclude, uncheck Include
                    const includeCb = document.getElementById(`inc_${e.target.value}`);
                    if (includeCb) includeCb.checked = false;
                }
                calculate();
            });
        });
    }

    function getConstraints() {
        const constraints = {};
        document.querySelectorAll('.constraint-input').forEach(input => {
            const id = input.dataset.id;
            const type = input.dataset.type;
            // New Logic: Check if empty string or just whitespace
            const rawValue = input.value.trim();
            let value;

            if (rawValue === '') {
                value = -1; // -1 means Unlimited
            } else {
                value = parseInt(rawValue);
                if (isNaN(value)) value = -1; // Fallback
            }

            if (!constraints[id]) constraints[id] = { single: -1, continuous: -1 };
            constraints[id][type] = value;
        });
        return constraints;
    }

    function getSelectedFilterCrops() {
        const selected = [];
        document.querySelectorAll('.crop-include:checked').forEach(cb => selected.push(cb.value));
        return selected;
    }

    function getSelectedExcludeCrops() {
        const selected = [];
        document.querySelectorAll('.crop-exclude:checked').forEach(cb => selected.push(cb.value));
        return selected;
    }

    function calculate() {
        // --- Inputs ---
        const currentDay = parseInt(document.getElementById('currentDay').value) || 1;
        const budget = parseFloat(document.getElementById('budget').value) || 0;
        const tiles = parseInt(document.getElementById('tiles').value) || 0;
        const hasTiller = document.getElementById('perkTiller').checked;
        const hasAgri = document.getElementById('perkAgriculturist').checked;
        const strategy = document.querySelector('input[name="strategy"]:checked').value;
        const fertilizerType = document.getElementById('fertilizerSelect').value;
        const fertilizer = fertilizers[fertilizerType];
        const constraints = getConstraints();
        const validCrops = getValidCrops();

        // --- Filter Inputs ---
        const filterProfitMin = parseFloat(document.getElementById('filterProfitMin').value);
        const filterProfitMax = parseFloat(document.getElementById('filterProfitMax').value);
        const filterPlantingMin = parseInt(document.getElementById('filterPlantingMin').value);
        const filterPlantingMax = parseInt(document.getElementById('filterPlantingMax').value);
        const filterDaysMin = parseInt(document.getElementById('filterDaysMin').value);
        const filterDaysMax = parseInt(document.getElementById('filterDaysMax').value);
        const selectedFilterCrops = getSelectedFilterCrops();
        const selectedExcludeCrops = getSelectedExcludeCrops();

        // --- Sort Inputs ---
        const sortType = document.getElementById('sortType').value;
        const sortOrder = document.getElementById('sortOrder').value;

        document.getElementById('daysRemainingDisplay').innerText = 28 - currentDay;

        // --- Core Calc ---
        const cropStats = validCrops.map(crop => {
            let sellPrice = crop.sell;
            if (hasTiller) sellPrice = Math.floor(sellPrice * 1.1);
            sellPrice = Math.floor(sellPrice * fertilizer.qualityMod);

            let growthMod = fertilizer.growthMod;
            if (hasAgri) growthMod -= 0.1;
            let growthDays = Math.max(1, Math.floor(crop.days * growthMod));
            const unitInitialCost = crop.buy + fertilizer.cost;

            if (currentDay + growthDays > 28) return null;

            let totalRevenueOneTile = 0;
            let totalCostOneTile = 0;
            let harvestCount = 0;
            let plantingCount = 0;
            let note = "";

            const cropConstraint = constraints[crop.id] || { single: -1, continuous: -1 };
            const limit = strategy === 'single' ? cropConstraint.single : cropConstraint.continuous;

            // If limit is 0, user wants 0 rounds. Explicit disable.
            if (limit === 0) return null;

            if (crop.regrow > 0) {
                const firstHarvestDay = currentDay + growthDays;
                if (firstHarvestDay <= 28) {
                    let potentialHarvests = 1;
                    const daysAfterFirst = 28 - firstHarvestDay;
                    potentialHarvests += Math.floor(daysAfterFirst / crop.regrow);

                    // Logic: if limit is -1 (unlimited), use potential. Else use min(potential, limit).
                    harvestCount = (limit === -1) ? potentialHarvests : Math.min(potentialHarvests, limit);
                }
                plantingCount = 1;
                totalCostOneTile = unitInitialCost;
                totalRevenueOneTile = harvestCount * sellPrice * crop.yield;
                note = `æ”¶å‰² ${harvestCount} æ¬¡`;
            } else {
                if (strategy === 'single') {
                    // Single Strategy typically means 1 round max.
                    // But if limit is set, maybe user wants 0 rounds (handled above).
                    // If limit > 1? Strategy name implies single. So we clamp to 1?
                    // "Single Planting Strategy" usually implies 1 batch.
                    // But if user sets limit to 5, it doesn't make sense for single strategy.
                    // So we stick to 1 round unless limit is 0.
                    harvestCount = 1;
                    plantingCount = 1;

                    totalCostOneTile = unitInitialCost;
                    totalRevenueOneTile = harvestCount * sellPrice * crop.yield;
                    note = `å•æ¬¡ç§æ¤ 1 è½®`;
                } else {
                    let potentialRounds = Math.floor((28 - currentDay) / growthDays);

                    harvestCount = (limit === -1) ? potentialRounds : Math.min(potentialRounds, limit);

                    if (harvestCount < 1) return null;
                    plantingCount = harvestCount;
                    totalCostOneTile = (crop.buy * harvestCount) + fertilizer.cost;
                    totalRevenueOneTile = harvestCount * sellPrice * crop.yield;
                    note = `è¿ç§ ${harvestCount} è½®`;
                }
            }

            return {
                ...crop,
                growthDays,
                unitInitialCost,
                netProfitOneTile: totalRevenueOneTile - totalCostOneTile,
                harvestCount,
                plantingCount,
                note,
                sellPriceCalculated: sellPrice
            };
        }).filter(item => item !== null && item.harvestCount > 0);

        // --- Generate All Valid Strategies ---
        let rawStrategies = [];

        // 1. Single Strategies
        cropStats.forEach(stat => {
            const maxBuy = Math.floor(budget / stat.unitInitialCost);
            const quantity = Math.min(maxBuy, tiles);
            if (quantity > 0) {
                let displayNote = stat.note;
                if (strategy === 'seasonal' && stat.regrow === 0 && stat.harvestCount > 1) {
                    displayNote += ` (æ¯è½® ${quantity} ä¸ª)`;
                }
                rawStrategies.push({
                    id: stat.id,
                    name: stat.name,
                    type: 'single',
                    netProfit: stat.netProfitOneTile * quantity,
                    initialCost: quantity * stat.unitInitialCost,
                    quantity: quantity,
                    plantingCount: stat.plantingCount,
                    growthDays: stat.growthDays,
                    roi: (stat.netProfitOneTile * quantity) / (quantity * stat.unitInitialCost) * 100,
                    components: [{...stat, quantity}],
                    displayData: { ...stat, quantity, initialCost: quantity * stat.unitInitialCost, note: displayNote }
                });
            }
        });

        // 2. Mixed Strategies
        for (let i = 0; i < cropStats.length; i++) {
            const primary = cropStats[i];
            for (let j = 0; j < cropStats.length; j++) {
                const filler = cropStats[j];
                if (filler.unitInitialCost > primary.unitInitialCost) continue;
                if (primary.id === filler.id) continue;

                const costDiff = primary.unitInitialCost - filler.unitInitialCost;
                let qA = Math.floor((budget - tiles * filler.unitInitialCost) / costDiff);
                if (qA < 0) qA = 0; if (qA > tiles) qA = tiles;
                let qB = tiles - qA;

                if (qA * primary.unitInitialCost + qB * filler.unitInitialCost > budget) { qA--; qB++; }
                if (qA < 0) { qA = 0; qB = Math.floor(budget / filler.unitInitialCost); }
                if (qA <= 0 && qB <= 0) continue;

                let comps = [];
                if (qA > 0) comps.push({ ...primary, quantity: qA });
                if (qB > 0) comps.push({ ...filler, quantity: qB });

                let currentCost = (qA * primary.unitInitialCost) + (qB * filler.unitInitialCost);
                let remainingBudget = budget - currentCost;

                if (comps.length > 0 && remainingBudget > 0) {
                    comps.sort((a,b) => a.netProfitOneTile - b.netProfitOneTile);
                    for (let k = 0; k < comps.length; k++) {
                        let comp = comps[k];
                        let bestUpgrade = null;
                        for (let u = 0; u < cropStats.length; u++) {
                            const cand = cropStats[u];
                            if (cand.netProfitOneTile <= comp.netProfitOneTile) continue;
                            const diff = cand.unitInitialCost - comp.unitInitialCost;
                            if (diff > remainingBudget) continue;
                            bestUpgrade = { ...cand, costDiff: diff };
                        }
                        if (bestUpgrade) {
                            let swap = comp.quantity;
                            if (bestUpgrade.costDiff > 0) swap = Math.min(swap, Math.floor(remainingBudget / bestUpgrade.costDiff));
                            if (swap > 0) {
                                comp.quantity -= swap;
                                remainingBudget -= (swap * bestUpgrade.costDiff);
                                const ex = comps.find(c => c.id === bestUpgrade.id);
                                if (ex) ex.quantity += swap; else comps.push({ ...bestUpgrade, quantity: swap });
                            }
                        }
                    }
                }

                comps = comps.filter(c => c.quantity > 0);
                if (comps.length >= 2) {
                    let rev = 0, cost = 0, maxPlant = 0, maxDays = 0;
                    let displayComps = [];
                    comps.sort((a,b) => b.quantity - a.quantity);
                    comps.forEach(c => {
                        rev += c.netProfitOneTile * c.quantity;
                        cost += c.unitInitialCost * c.quantity;
                        maxPlant = Math.max(maxPlant, c.plantingCount);
                        maxDays = Math.max(maxDays, c.growthDays);

                        let note = c.note;
                        if (strategy === 'seasonal' && c.regrow === 0 && c.harvestCount > 1) {
                            note += ` (æ¯è½® ${c.quantity} ä¸ª)`;
                        }
                        displayComps.push({...c, note});
                    });

                    let names = displayComps.map(c => c.name.split(' ')[0]);

                    rawStrategies.push({
                        name: `ç»„åˆ: ${names.join(' + ')}`,
                        type: 'mixed',
                        netProfit: rev,
                        initialCost: cost,
                        components: displayComps,
                        plantingCount: maxPlant,
                        growthDays: maxDays,
                        roi: (rev/cost) * 100
                    });
                }
            }
        }

        // Deduplicate
        let uniqueStrategies = [];
        let seen = new Set();
        rawStrategies.forEach(s => {
            const comps = s.type==='single' ? s.components : [...s.components].sort((a,b) => a.id.localeCompare(b.id));
            let key = comps.map(c => `${c.id}:${c.quantity}`).join('|');
            if (!seen.has(key)) { uniqueStrategies.push(s); seen.add(key); }
        });

        // --- Apply Filters ---
        let filteredStrategies = uniqueStrategies.filter(s => {
            if (s.netProfit < 0) return false;

            if (!isNaN(filterProfitMin) && s.netProfit < filterProfitMin) return false;
            if (!isNaN(filterProfitMax) && s.netProfit > filterProfitMax) return false;

            if (!isNaN(filterPlantingMin) && s.plantingCount < filterPlantingMin) return false;
            if (!isNaN(filterPlantingMax) && s.plantingCount > filterPlantingMax) return false;

            if (!isNaN(filterDaysMin)) {
                if (s.type === 'single') { if (s.growthDays <= filterDaysMin) return false; }
                else { if (s.components.some(c => c.growthDays <= filterDaysMin)) return false; }
            }
            if (!isNaN(filterDaysMax)) {
                if (s.type === 'single') { if (s.growthDays >= filterDaysMax) return false; }
                else { if (s.components.some(c => c.growthDays >= filterDaysMax)) return false; }
            }

            // Exclude Filter (New Logic)
            if (selectedExcludeCrops.length > 0) {
                const hasExcluded = s.type === 'single'
                    ? selectedExcludeCrops.includes(s.id)
                    : s.components.some(c => selectedExcludeCrops.includes(c.id));
                if (hasExcluded) return false;
            }

            // Include Filter
            if (selectedFilterCrops.length > 0) {
                const hasMatch = s.type === 'single'
                    ? selectedFilterCrops.includes(s.id)
                    : s.components.some(c => selectedFilterCrops.includes(c.id));
                if (!hasMatch) return false;
            }

            return true;
        });

        // --- Sorting ---
        filteredStrategies.sort((a, b) => {
            let valA, valB;
            switch(sortType) {
                case 'planting': valA = a.plantingCount; valB = b.plantingCount; break;
                case 'days': valA = a.growthDays; valB = b.growthDays; break;
                case 'profit': default: valA = a.netProfit; valB = b.netProfit; break;
            }

            if (sortOrder === 'asc') return valA - valB;
            return valB - valA;
        });

        // --- Render ---
        const container = document.getElementById('unifiedResultsContainer');
        container.innerHTML = '';
        document.getElementById('resultCountBadge').innerText = `å…± ${filteredStrategies.length} ä¸ªæ–¹æ¡ˆ`;

        if (filteredStrategies.length === 0) {
            container.innerHTML = `<div class="p-4 text-center text-gray-500">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ–¹æ¡ˆã€‚</div>`;
        } else {
            filteredStrategies.forEach((s, idx) => {
                const formatMoney = (n) => n.toLocaleString('en-US');
                const profitSign = s.netProfit > 0 ? '+' : '';
                const profitClass = s.netProfit > 0 ? 'text-purple-700' : 'text-red-700';
                let rankClass = idx < 3 ? `rank-${idx+1}` : 'rank-other';

                if (s.type === 'mixed') {
                    const totalQty = s.components.reduce((sum, c) => sum + c.quantity, 0);
                    let detailsHtml = s.components.map(c => `
                        <div class="flex justify-between items-center bg-white p-2 rounded mb-1 border border-purple-100">
                            <div class="flex items-center gap-2">
                                 <div class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-lg border border-gray-300">
                                    ${getCropIconHtml(c)}
                                </div>
                                <div>
                                    <div class="font-bold text-sm text-gray-800">${c.name}</div>
                                    <div class="text-xs text-gray-500">${c.note}</div>
                                </div>
                            </div>
                            <div class="text-right text-sm">
                                <div class="font-bold text-blue-700">x${c.quantity}</div>
                                <div class="text-xs text-red-500">æŠ•å…¥: ${formatMoney(c.quantity * c.unitInitialCost)}g</div>
                            </div>
                        </div>
                    `).join('');

                    const html = `
                    <div class="strategy-card">
                        <details class="group">
                            <summary class="strategy-summary p-4 rounded-lg flex flex-col md:flex-row gap-4 items-center cursor-pointer relative">
                                <div class="absolute top-2 left-2 rank-badge ${rankClass}">#${idx+1}</div>
                                <div class="flex-shrink-0 w-full md:w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center text-2xl border-2 border-purple-200 ml-8 md:ml-0">âš–ï¸</div>
                                <div class="flex-grow w-full">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <h3 class="font-bold text-lg text-purple-900">${s.name}</h3>
                                            <div class="text-xs text-gray-600 mt-1 flex gap-2">
                                                <span>æ··åˆç­–ç•¥</span>
                                                <span class="bg-gray-200 px-1 rounded">æ’­ç§: ${s.plantingCount}æ¬¡</span>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xl font-bold ${profitClass}">${profitSign}${formatMoney(Math.floor(s.netProfit))}g</div>
                                            <div class="text-xs text-gray-500">é¢„æœŸå‡€åˆ©</div>
                                        </div>
                                    </div>
                                    <div class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-2 text-sm bg-white bg-opacity-60 p-2 rounded border border-purple-100">
                                        <div><span class="block text-gray-500 text-xs">ä½œç‰©ç§ç±»</span><span class="font-bold text-blue-800">${s.components.length} ç§</span></div>
                                        <div><span class="block text-gray-500 text-xs">æ€»ç§æ¤æ•°</span><span class="font-bold text-brown-800">${totalQty} ä¸ª</span></div>
                                        <div><span class="block text-gray-500 text-xs">åˆå§‹æŠ•å…¥</span><span class="font-bold text-red-700">-${formatMoney(s.initialCost)}g</span></div>
                                        <div><span class="block text-gray-500 text-xs">æŠ•èµ„å›æŠ¥ç‡</span><span class="font-bold ${s.roi > 200 ? 'text-green-600' : 'text-blue-600'}">${Math.floor(s.roi)}%</span></div>
                                    </div>
                                </div>
                            </summary>
                            <div class="strategy-details">
                                <h4 class="text-xs font-bold text-gray-500 mb-2 uppercase tracking-wide">ç§æ¤è¯¦æƒ…</h4>
                                ${detailsHtml}
                            </div>
                        </details>
                    </div>`;
                    container.innerHTML += html;
                } else {
                    const r = s.displayData;
                    const singleProfitClass = s.netProfit > 0 ? 'text-green-700' : 'text-red-700';
                    const html = `
                        <div class="crop-card p-4 rounded-lg flex flex-col md:flex-row gap-4 items-center">
                             <div class="absolute top-2 left-2 rank-badge ${rankClass}">#${idx+1}</div>
                            <div class="flex-shrink-0 w-full md:w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center text-2xl border-2 border-gray-300 ml-8 md:ml-0">
                                ${getCropIconHtml(r)}
                            </div>
                            <div class="flex-grow w-full">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h3 class="font-bold text-lg text-brown-900">${r.name}</h3>
                                        <div class="text-xs text-gray-600 mt-1 flex flex-wrap gap-2">
                                            <span class="bg-gray-200 px-2 py-0.5 rounded">å•ä»·: ${r.unitInitialCost}g</span>
                                            <span class="bg-gray-200 px-2 py-0.5 rounded">æ’­ç§: ${s.plantingCount}æ¬¡</span>
                                            <span class="bg-gray-200 px-2 py-0.5 rounded">ç”Ÿé•¿: ${r.growthDays}å¤©</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xl font-bold ${singleProfitClass}">${profitSign}${formatMoney(Math.floor(s.netProfit))}g</div>
                                        <div class="text-xs text-gray-500">æœ¬å­£å‡€åˆ©æ¶¦</div>
                                    </div>
                                </div>
                                <div class="mt-3 grid grid-cols-2 md:grid-cols-4 gap-2 text-sm bg-white bg-opacity-50 p-2 rounded">
                                    <div><span class="block text-gray-500 text-xs">è´­ä¹°æ•°é‡</span><span class="font-bold text-blue-800">${r.quantity} ä¸ª</span></div>
                                    <div><span class="block text-gray-500 text-xs">ç§æ¤ç­–ç•¥</span><span class="font-bold text-brown-800">${r.note}</span></div>
                                    <div><span class="block text-gray-500 text-xs">åˆå§‹æŠ•å…¥</span><span class="font-bold text-red-700">-${formatMoney(r.initialCost)}g</span></div>
                                    <div><span class="block text-gray-500 text-xs">æŠ•èµ„å›æŠ¥ç‡</span><span class="font-bold ${s.roi > 200 ? 'text-green-600' : 'text-blue-600'}">${Math.floor(s.roi)}%</span></div>
                                </div>
                                 ${r.note.includes('æ£šæ¶') ? '<p class="text-xs text-red-500 mt-1">âš ï¸ æ³¨æ„ï¼šæ­¤ä¸ºæ£šæ¶ä½œç‰©ã€‚</p>' : ''}
                                 ${r.quantity < tiles && r.initialCost >= budget ? '<p class="text-xs text-orange-500 mt-1">ğŸ’¡ èµ„é‡‘å—é™ã€‚</p>' : ''}
                            </div>
                        </div>
                    `;
                    container.innerHTML += html;
                }
            });
        }
    }

    // Initial run
    updateUI();
</script>

</body>
</html>
